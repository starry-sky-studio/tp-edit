@layer utilities {
  .ProseMirror .tableWrapper {
    @apply my-2;
    overflow-x: auto;
    overflow-y: visible !important;
    position: relative !important;
  }

  .ProseMirror table {
    margin-top: 24px !important;
    margin-left: 24px !important;
    @apply box-border w-max table-fixed border-collapse rounded border border-black/10;

    /* 鼠标悬停和活跃状态时显示所有 .grid 子元素 */
    &:hover,
    &:focus,
    &:focus-within,
    &.selected,
    &.editing {
      .grid {
        opacity: 1 !important;
        visibility: visible !important;
        transform: scale(1) !important;
        transition: all 0.2s ease !important;
      }

      /* 显示列头 grips */
      .grip-column {
        opacity: 1 !important;
        visibility: visible !important;
      }

      /* 显示行头 grips */
      .grip-row {
        opacity: 1 !important;
        visibility: visible !important;
      }

      /* 显示自定义头部操作按钮 */
      .custom-table-header {
        opacity: 1 !important;
        visibility: visible !important;
        transform: translateY(0) !important;
      }

      /* 悬停时放大伪元素，活跃状态时正常显示 */
      .grid .pseudoElement {
        transform: translate(-50%, -50%) scale(1.2) !important;
        opacity: 1 !important;
      }

      /* 最后一列的指示器 */
      .grid .grip-last-indicator {
        transform: translate(50%, -50%) scale(1.3) !important;
        opacity: 1 !important;
      }
    }

    /* 默认隐藏 .grid 元素 */
    /* .grid {
      opacity: 0;
      visibility: hidden;
      transform: scale(0.8);
      transition: all 0.2s ease;
    } */

    /* 默认隐藏 grips */
    /* .grip-column,
    .grip-row {
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s ease;
    } */

    /* 默认隐藏自定义头部 */
    /* .custom-table-header {
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.2s ease;
    } */

    /* 默认隐藏伪元素 */
    /* .grid .pseudoElement {
      opacity: 0;
      transform: translate(-50%, -50%) scale(1);
      transition: all 0.2s ease;
    }

    .grid .grip-last-indicator {
      opacity: 0;
      transform: translate(50%, -50%) scale(1);
      transition: all 0.2s ease;
    } */
  }

  /* 统一行高，纵向合并 (rowspan) 时高度为各行之和 */
  /* .ProseMirror table tr {
    @apply h-10;
  */

  /* 固定列宽到 col，合并单元格时宽度为列宽之和 */
  .ProseMirror table col {
    @apply w-[200px];
  }

  .ProseMirror table td,
  .ProseMirror table th {
    @apply !relative border border-black/10 p-2 text-left align-top;
  }

  /* 进入/聚焦单元格时，移除段落默认外边距，避免行高被撑大 */
  .ProseMirror table td p,
  .ProseMirror table th p {
    @apply m-0;
  }
  .ProseMirror table td p:first-child,
  .ProseMirror table th p:first-child,
  .ProseMirror table td p:last-child,
  .ProseMirror table th p:last-child {
    @apply m-0;
  }

  .ProseMirror table .column-resize-handle {
    @apply pointer-events-none absolute top-0 -right-1 -bottom-[2px] flex w-1 bg-[#adf];
  }

  .resize-cursor {
    @apply cursor-ew-resize;
  }

  .ProseMirror table .selectedCell {
    @apply relative;
  }

  .ProseMirror table .selectedCell:after {
    content: '';
    @apply pointer-events-none absolute inset-0 z-[2] bg-[#c9d7f5] opacity-20 shadow-[inset_0_0_0_1px_#c9d7f5];
  }
}
